name: DNS Blocklist Updater
on:
  schedule:
    -  cron: '30 3 * * *'  # 03:30 UTC = 9:00 AM IST
  workflow_dispatch:      # Keep this for manual runs

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
    
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Create Blocklist
      run: |
        # Create fresh file
        > blocklist.txt
        
        # Download and paste each link IN ORDER
        echo "=== doh-vpn-proxy-bypass.txt ===" >> blocklist.txt
        curl -s "https://gitlab.com/hagezi/mirror/-/raw/main/dns-blocklists/adblock/doh-vpn-proxy-bypass.txt" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== tif.txt ===" >> blocklist.txt
        curl -s "https://cdn.jsdelivr.net/gh/hagezi/dns-blocklists@latest/domains/tif.txt" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== ultimate.txt ===" >> blocklist.txt
        curl -s "https://cdn.jsdelivr.net/gh/hagezi/dns-blocklists@latest/domains/ultimate.txt" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== spam-tlds.txt ===" >> blocklist.txt
        curl -s "https://raw.githubusercontent.com/hagezi/dns-blocklists/main/adblock/spam-tlds.txt" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== dyndns.txt ===" >> blocklist.txt
        curl -s "https://gitlab.com/hagezi/mirror/-/raw/main/dns-blocklists/adblock/dyndns.txt" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== dns-rebind-protection.txt ===" >> blocklist.txt
        curl -s "https://gitlab.com/hagezi/mirror/-/raw/main/dns-blocklists/adguard/dns-rebind-protection.txt" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== social.txt ===" >> blocklist.txt
        curl -s "https://gitlab.com/hagezi/mirror/-/raw/main/dns-blocklists/adblock/social.txt" >> blocklist.txt
        echo "" >> blocklist.txt
        
        # === GOOGLE BLOCKLISTS ===
        echo "=== analyticsparsed (Google Analytics) ===" >> blocklist.txt
        curl -s "https://raw.githubusercontent.com/nickspaargaren/no-google/master/categories/analyticsparsed" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== doubleclickparsed (Google Ads) ===" >> blocklist.txt
        curl -s "https://raw.githubusercontent.com/nickspaargaren/no-google/master/categories/doubleclickparsed" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== dnsparsed (Google DNS) ===" >> blocklist.txt
        curl -s "https://raw.githubusercontent.com/nickspaargaren/no-google/master/categories/dnsparsed" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== proxiesparsed (Google Proxies) ===" >> blocklist.txt
        curl -s "https://raw.githubusercontent.com/nickspaargaren/no-google/master/categories/proxiesparsed" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== shortlinksparsed (goo.gl links) ===" >> blocklist.txt
        curl -s "https://raw.githubusercontent.com/nickspaargaren/no-google/master/categories/shortlinksparsed" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== fontsparsed (Google Fonts) ===" >> blocklist.txt
        curl -s "https://raw.githubusercontent.com/nickspaargaren/no-google/master/categories/fontsparsed" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== productsparsed (Google Shopping) ===" >> blocklist.txt
        curl -s "https://raw.githubusercontent.com/nickspaargaren/no-google/master/categories/productsparsed" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== androidparsed (Android/Play Store) ===" >> blocklist.txt
        curl -s "https://raw.githubusercontent.com/nickspaargaren/no-google/master/categories/androidparsed" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== fiberparsed (Google Fiber) ===" >> blocklist.txt
        curl -s "https://raw.githubusercontent.com/nickspaargaren/no-google/master/categories/fiberparsed" >> blocklist.txt
        echo "" >> blocklist.txt

        echo "=== Firebase (Google Firebase) ===" >> blocklist.txt
        curl -s "https://raw.githubusercontent.com/nickspaargaren/no-google/master/categories/firebaseparsed" >> blocklist.txt
        echo "" >> blocklist.txt

        echo "=== General (Google General) ===" >> blocklist.txt
        curl -s "https://raw.githubusercontent.com/nickspaargaren/no-google/master/categories/generalparsed" >> blocklist.txt
        echo "" >> blocklist.txt
        
        # === ADDITIONAL LISTS ===
        echo "=== native.oppo-realme.txt ===" >> blocklist.txt
        curl -s "https://cdn.jsdelivr.net/gh/hagezi/dns-blocklists@latest/domains/native.oppo-realme.txt" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== Microsoft All (corporate) ===" >> blocklist.txt
        curl -s "https://raw.githubusercontent.com/jmdugan/blocklists/master/corporations/microsoft/all" >> blocklist.txt
        
        echo "âœ… Created blocklist.txt with all content in order"
        
    - name: Commit Changes
      run: |
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        git add blocklist.txt
        git commit -m "Update: $(date)" || echo "No changes"
        git push
