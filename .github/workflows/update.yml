name: DNS Blocklist Updater
on:
  schedule:
    - cron: '0 0 * * *'  # ADD THIS LINE - runs daily at midnight UTC
  workflow_dispatch:      # Keep this for manual runs

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
    
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Create Blocklist
      run: |
        # Create fresh file
        > blocklist.txt
        
        # Download and paste each link IN ORDER
        echo "=== doh-vpn-proxy-bypass.txt ===" >> blocklist.txt
        curl -s "https://gitlab.com/hagezi/mirror/-/raw/main/dns-blocklists/adblock/doh-vpn-proxy-bypass.txt" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== tif.txt ===" >> blocklist.txt
        curl -s "https://cdn.jsdelivr.net/gh/hagezi/dns-blocklists@latest/domains/tif.txt" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== ultimate.txt ===" >> blocklist.txt
        curl -s "https://cdn.jsdelivr.net/gh/hagezi/dns-blocklists@latest/domains/ultimate.txt" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== spam-tlds.txt ===" >> blocklist.txt
        curl -s "https://raw.githubusercontent.com/hagezi/dns-blocklists/main/adblock/spam-tlds.txt" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== dyndns.txt ===" >> blocklist.txt
        curl -s "https://gitlab.com/hagezi/mirror/-/raw/main/dns-blocklists/adblock/dyndns.txt" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== dns-rebind-protection.txt ===" >> blocklist.txt
        curl -s "https://gitlab.com/hagezi/mirror/-/raw/main/dns-blocklists/adguard/dns-rebind-protection.txt" >> blocklist.txt
        echo "" >> blocklist.txt
        
        echo "=== social.txt ===" >> blocklist.txt
        curl -s "https://gitlab.com/hagezi/mirror/-/raw/main/dns-blocklists/adblock/social.txt" >> blocklist.txt
        
        echo "âœ… Created blocklist.txt with all content in order"
        
    - name: Commit Changes
      run: |
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        git add blocklist.txt
        git commit -m "Update: $(date)" || echo "No changes"
        git push
